<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <defs>
    <linearGradient id="stage1" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#11998e"/>
      <stop offset="100%" style="stop-color:#38ef7d"/>
    </linearGradient>
    <linearGradient id="stage2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#ee0979"/>
      <stop offset="100%" style="stop-color:#ff6a00"/>
    </linearGradient>
    <linearGradient id="stage3" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4776E6"/>
      <stop offset="100%" style="stop-color:#8E54E9"/>
    </linearGradient>
    <filter id="shadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <rect width="800" height="600" fill="#0d1117" rx="10"/>
  
  <text x="400" y="35" text-anchor="middle" fill="#f8fafc" font-size="20" font-weight="bold">Two-Stage Recommendation Architecture</text>
  
  <!-- Request -->
  <g transform="translate(350, 55)">
    <rect x="0" y="0" width="100" height="40" rx="8" fill="rgba(255,255,255,0.2)"/>
    <text x="50" y="26" text-anchor="middle" fill="#f8fafc" font-size="11" font-weight="bold">ðŸ“± Request</text>
  </g>
  
  <path d="M 400 100 L 400 130" stroke="#f8fafc" stroke-width="2" marker-end="url(#arrow6)"/>
  
  <!-- Stage 1: Candidate Generation -->
  <g transform="translate(100, 140)">
    <rect x="0" y="0" width="600" height="130" rx="15" fill="url(#stage1)" filter="url(#shadow)"/>
    <text x="300" y="25" text-anchor="middle" fill="#f8fafc" font-size="14" font-weight="bold">STAGE 1: CANDIDATE GENERATION</text>
    <text x="300" y="42" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">(High Recall, Fast)</text>
    
    <g transform="translate(30, 55)">
      <rect x="0" y="0" width="120" height="55" rx="8" fill="rgba(255,255,255,0.25)"/>
      <text x="60" y="22" text-anchor="middle" fill="#f8fafc" font-size="10" font-weight="bold">ANN Index</text>
      <text x="60" y="42" text-anchor="middle" fill="#f8fafc" font-size="8">FAISS</text>
    </g>
    
    <g transform="translate(170, 55)">
      <rect x="0" y="0" width="120" height="55" rx="8" fill="rgba(255,255,255,0.25)"/>
      <text x="60" y="22" text-anchor="middle" fill="#f8fafc" font-size="10" font-weight="bold">CF Cache</text>
      <text x="60" y="42" text-anchor="middle" fill="#f8fafc" font-size="8">Pre-computed</text>
    </g>
    
    <g transform="translate(310, 55)">
      <rect x="0" y="0" width="120" height="55" rx="8" fill="rgba(255,255,255,0.25)"/>
      <text x="60" y="22" text-anchor="middle" fill="#f8fafc" font-size="10" font-weight="bold">Popular</text>
      <text x="60" y="42" text-anchor="middle" fill="#f8fafc" font-size="8">Trending</text>
    </g>
    
    <g transform="translate(450, 55)">
      <rect x="0" y="0" width="120" height="55" rx="8" fill="rgba(255,255,255,0.25)"/>
      <text x="60" y="22" text-anchor="middle" fill="#f8fafc" font-size="10" font-weight="bold">Search</text>
      <text x="60" y="42" text-anchor="middle" fill="#f8fafc" font-size="8">Query-based</text>
    </g>
  </g>
  
  <path d="M 400 280 L 400 310" stroke="#f8fafc" stroke-width="2" marker-end="url(#arrow6)"/>
  <text x="420" y="300" fill="#aaaaaa" font-size="9">1000-10000 candidates</text>
  
  <!-- Stage 2: Ranking -->
  <g transform="translate(150, 320)">
    <rect x="0" y="0" width="500" height="100" rx="15" fill="url(#stage2)" filter="url(#shadow)"/>
    <text x="250" y="25" text-anchor="middle" fill="#f8fafc" font-size="14" font-weight="bold">STAGE 2: RANKING</text>
    <text x="250" y="42" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">(High Precision, ML Model)</text>
    
    <text x="250" y="75" text-anchor="middle" fill="#f8fafc" font-size="11">Features â†’ DNN Ranker â†’ Scored Candidates â†’ Top 10-50</text>
  </g>
  
  <path d="M 400 430 L 400 460" stroke="#f8fafc" stroke-width="2" marker-end="url(#arrow6)"/>
  
  <!-- Stage 3: Re-ranking -->
  <g transform="translate(175, 470)">
    <rect x="0" y="0" width="450" height="100" rx="15" fill="url(#stage3)" filter="url(#shadow)"/>
    <text x="225" y="25" text-anchor="middle" fill="#f8fafc" font-size="14" font-weight="bold">STAGE 3: RE-RANKING</text>
    <text x="225" y="42" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">(Business Rules, Diversity, Filtering)</text>
    
    <text x="225" y="75" text-anchor="middle" fill="#f8fafc" font-size="11">Diversity â†’ Business Rules â†’ A/B Treatment â†’ Final List</text>
  </g>
  
  <defs>
    <marker id="arrow6" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#f8fafc"/>
    </marker>
  </defs>
</svg>
