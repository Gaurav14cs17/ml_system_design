<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 550">
  <defs>
    <linearGradient id="requestGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#00d9ff"/>
      <stop offset="100%" style="stop-color:#00ff88"/>
    </linearGradient>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#00ff88"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="550" fill="#0d1117"/>
  
  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" fill="#e6edf3" font-family="Arial, sans-serif" font-size="22" font-weight="bold">
    Request Flow &amp; Serving Architecture
  </text>
  
  <!-- Timeline bar -->
  <rect x="50" y="60" width="800" height="30" rx="5" fill="#21262d"/>
  <rect x="50" y="60" width="100" height="30" rx="5" fill="#58a6ff" opacity="0.5"/>
  <rect x="150" y="60" width="50" height="30" fill="#3fb950" opacity="0.5"/>
  <rect x="200" y="60" width="200" height="30" fill="#f85149" opacity="0.5"/>
  <rect x="400" y="60" width="100" height="30" fill="#d29922" opacity="0.5"/>
  <rect x="500" y="60" width="250" height="30" fill="#a371f7" opacity="0.5"/>
  <rect x="750" y="60" width="100" height="30" rx="5" fill="#58a6ff" opacity="0.5"/>
  
  <text x="100" y="80" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10">Parse</text>
  <text x="175" y="80" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10">LB</text>
  <text x="300" y="80" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10">Feature Lookup (2ms)</text>
  <text x="450" y="80" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10">Transform</text>
  <text x="625" y="80" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10">Model Inference (3ms)</text>
  <text x="800" y="80" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10">Response</text>
  
  <!-- Total time -->
  <text x="450" y="105" text-anchor="middle" fill="#3fb950" font-family="Arial" font-size="12" font-weight="bold">
    Total: ~7ms (Target: andlt;10ms p99)
  </text>
  
  <!-- Request -->
  <g transform="translate(30, 130)">
    <rect x="0" y="0" width="100" height="50" rx="8" fill="#21262d" stroke="#58a6ff" stroke-width="2"/>
    <text x="50" y="22" text-anchor="middle" fill="#58a6ff" font-family="Arial" font-size="12" font-weight="bold">Request</text>
    <text x="50" y="40" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="10">user, ads, ctx</text>
  </g>
  
  <!-- Load Balancer -->
  <g transform="translate(180, 130)">
    <rect x="0" y="0" width="100" height="50" rx="8" fill="#3fb950" opacity="0.2" stroke="#3fb950" stroke-width="2"/>
    <text x="50" y="22" text-anchor="middle" fill="#3fb950" font-family="Arial" font-size="12" font-weight="bold">Load Balancer</text>
    <text x="50" y="40" text-anchor="middle" fill="#7ee787" font-family="Arial" font-size="10">Round Robin</text>
  </g>
  
  <!-- API Gateway -->
  <g transform="translate(330, 130)">
    <rect x="0" y="0" width="120" height="50" rx="8" fill="#f85149" opacity="0.2" stroke="#f85149" stroke-width="2"/>
    <text x="60" y="22" text-anchor="middle" fill="#f85149" font-family="Arial" font-size="12" font-weight="bold">API Gateway</text>
    <text x="60" y="40" text-anchor="middle" fill="#ffa198" font-family="Arial" font-size="10">Auth, Rate Limit</text>
  </g>
  
  <!-- Arrows -->
  <path d="M130 155 L180 155" stroke="#58a6ff" stroke-width="2" fill="none" marker-end="url(#arrowGreen)"/>
  <path d="M280 155 L330 155" stroke="#3fb950" stroke-width="2" fill="none"/>
  <path d="M450 155 L450 200" stroke="#f85149" stroke-width="2" fill="none"/>
  
  <!-- Feature Service -->
  <g transform="translate(180, 220)">
    <rect x="0" y="0" width="140" height="120" rx="10" fill="#21262d" stroke="#d29922" stroke-width="2"/>
    <text x="70" y="25" text-anchor="middle" fill="#d29922" font-family="Arial" font-size="13" font-weight="bold">Feature Service</text>
    <line x1="15" y1="35" x2="125" y2="35" stroke="#30363d"/>
    
    <rect x="15" y="45" width="110" height="28" rx="4" fill="#161b22"/>
    <text x="70" y="64" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="10">User Features</text>
    
    <rect x="15" y="80" width="110" height="28" rx="4" fill="#161b22"/>
    <text x="70" y="99" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="10">Ad Features</text>
  </g>
  
  <!-- Redis Cache -->
  <g transform="translate(30, 260)">
    <rect x="0" y="0" width="100" height="60" rx="8" fill="#f85149"/>
    <text x="50" y="25" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="12" font-weight="bold">Redis</text>
    <text x="50" y="42" text-anchor="middle" fill="#ffd7d5" font-family="Arial" font-size="10">Feature Cache</text>
    <text x="50" y="55" text-anchor="middle" fill="#ffd7d5" font-family="Arial" font-size="9">andlt;1ms lookup</text>
  </g>
  
  <!-- Arrow to Redis -->
  <path d="M180 280 L130 280" stroke="#f85149" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  
  <!-- Prediction Service -->
  <g transform="translate(380, 220)">
    <rect x="0" y="0" width="140" height="120" rx="10" fill="#21262d" stroke="#a371f7" stroke-width="2"/>
    <text x="70" y="25" text-anchor="middle" fill="#a371f7" font-family="Arial" font-size="13" font-weight="bold">Prediction Service</text>
    <line x1="15" y1="35" x2="125" y2="35" stroke="#30363d"/>
    
    <rect x="15" y="45" width="110" height="28" rx="4" fill="#161b22"/>
    <text x="70" y="64" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="10">Feature Transform</text>
    
    <rect x="15" y="80" width="110" height="28" rx="4" fill="#161b22"/>
    <text x="70" y="99" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="10">Batch Inference</text>
  </g>
  
  <!-- Arrow between services -->
  <path d="M320 280 L380 280" stroke="#d29922" stroke-width="2" fill="none"/>
  
  <!-- Model Server -->
  <g transform="translate(580, 220)">
    <rect x="0" y="0" width="140" height="120" rx="10" fill="#a371f7"/>
    <text x="70" y="28" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="13" font-weight="bold">TF Serving</text>
    <text x="70" y="48" text-anchor="middle" fill="#e9d5ff" font-family="Arial" font-size="11">Model Server</text>
    
    <rect x="20" y="60" width="100" height="45" rx="5" fill="rgba(0,0,0,0.3)"/>
    <text x="70" y="78" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10">Wide &amp; Deep</text>
    <text x="70" y="95" text-anchor="middle" fill="#e9d5ff" font-family="Arial" font-size="9">v2.3.1 | GPU</text>
  </g>
  
  <!-- Arrow to Model Server -->
  <path d="M520 280 L580 280" stroke="#a371f7" stroke-width="2" fill="none"/>
  
  <!-- Model Registry -->
  <g transform="translate(770, 260)">
    <rect x="0" y="0" width="100" height="60" rx="8" fill="#21262d" stroke="#8b949e"/>
    <text x="50" y="25" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="11" font-weight="bold">Registry</text>
    <text x="50" y="45" text-anchor="middle" fill="#6e7681" font-family="Arial" font-size="10">Model Versions</text>
  </g>
  
  <!-- Arrow to Registry -->
  <path d="M720 290 L770 290" stroke="#8b949e" stroke-width="2" fill="none" stroke-dasharray="5,3"/>
  
  <!-- Response -->
  <g transform="translate(770, 130)">
    <rect x="0" y="0" width="100" height="50" rx="8" fill="#21262d" stroke="#3fb950" stroke-width="2"/>
    <text x="50" y="22" text-anchor="middle" fill="#3fb950" font-family="Arial" font-size="12" font-weight="bold">Response</text>
    <text x="50" y="40" text-anchor="middle" fill="#7ee787" font-family="Arial" font-size="10">[pCTR scores]</text>
  </g>
  
  <!-- Return arrow -->
  <path d="M720 280 L750 200 L770 155" stroke="#3fb950" stroke-width="2" fill="none"/>
  
  <!-- Caching Strategy Box -->
  <g transform="translate(50, 380)">
    <rect x="0" y="0" width="380" height="140" rx="10" fill="#161b22" stroke="#30363d"/>
    <text x="190" y="25" text-anchor="middle" fill="#e6edf3" font-family="Arial" font-size="14" font-weight="bold">Multi-Level Caching</text>
    
    <g transform="translate(20, 45)">
      <rect x="0" y="0" width="100" height="35" rx="5" fill="#3fb950"/>
      <text x="50" y="15" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10" font-weight="bold">L1: In-Memory</text>
      <text x="50" y="28" text-anchor="middle" fill="#c6f6d5" font-family="Arial" font-size="9">0.01ms | 80% hit</text>
    </g>
    
    <g transform="translate(135, 45)">
      <rect x="0" y="0" width="100" height="35" rx="5" fill="#d29922"/>
      <text x="50" y="15" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10" font-weight="bold">L2: Redis</text>
      <text x="50" y="28" text-anchor="middle" fill="#422006" font-family="Arial" font-size="9">0.5ms | 15% hit</text>
    </g>
    
    <g transform="translate(250, 45)">
      <rect x="0" y="0" width="110" height="35" rx="5" fill="#6e7681"/>
      <text x="55" y="15" text-anchor="middle" fill="#f8fafc" font-family="Arial" font-size="10" font-weight="bold">L3: Database</text>
      <text x="55" y="28" text-anchor="middle" fill="#d1d5da" font-family="Arial" font-size="9">10ms | 5% hit</text>
    </g>
    
    <text x="190" y="110" text-anchor="middle" fill="#3fb950" font-family="Arial" font-size="12" font-weight="bold">Overall Hit Rate: 99%+</text>
    <text x="190" y="128" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="10">Avg Lookup: andlt;0.2ms</text>
  </g>
  
  <!-- Fault Tolerance Box -->
  <g transform="translate(470, 380)">
    <rect x="0" y="0" width="380" height="140" rx="10" fill="#161b22" stroke="#30363d"/>
    <text x="190" y="25" text-anchor="middle" fill="#e6edf3" font-family="Arial" font-size="14" font-weight="bold">Fault Tolerance</text>
    
    <g transform="translate(20, 45)">
      <rect x="0" y="0" width="105" height="40" rx="5" fill="#21262d" stroke="#58a6ff"/>
      <text x="52" y="18" text-anchor="middle" fill="#58a6ff" font-family="Arial" font-size="10">Circuit Breaker</text>
      <text x="52" y="32" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="9">Auto-recovery</text>
    </g>
    
    <g transform="translate(135, 45)">
      <rect x="0" y="0" width="105" height="40" rx="5" fill="#21262d" stroke="#f85149"/>
      <text x="52" y="18" text-anchor="middle" fill="#f85149" font-family="Arial" font-size="10">Fallback</text>
      <text x="52" y="32" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="9">Default pCTR</text>
    </g>
    
    <g transform="translate(250, 45)">
      <rect x="0" y="0" width="110" height="40" rx="5" fill="#21262d" stroke="#3fb950"/>
      <text x="55" y="18" text-anchor="middle" fill="#3fb950" font-family="Arial" font-size="10">Retry Logic</text>
      <text x="55" y="32" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="9">Exp backoff</text>
    </g>
    
    <text x="190" y="110" text-anchor="middle" fill="#e6edf3" font-family="Arial" font-size="11">Target: 99.99% Availability</text>
    <text x="190" y="128" text-anchor="middle" fill="#8b949e" font-family="Arial" font-size="10">Max 4.3 min downtime/month</text>
  </g>
</svg>

